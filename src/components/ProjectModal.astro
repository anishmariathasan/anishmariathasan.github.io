---
// src/components/ProjectModal.astro
// This component renders a modal for expanded project details
---

<div id="project-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 opacity-0 pointer-events-none transition-opacity duration-300 ease-in-out" aria-modal="true" role="dialog" aria-labelledby="modal-title"> {/* Added aria-labelledby */}
  {/* Backdrop */}
  <div id="modal-backdrop" class="absolute inset-0 bg-black/80 backdrop-blur-sm"></div>

  {/* Modal content */}
  <div class="modal-content bg-gray-800 rounded-lg shadow-xl max-w-3xl w-full mx-auto relative z-10 overflow-hidden flex flex-col transform scale-95 transition-transform duration-300 ease-in-out">
    {/* Close button */}
    <button id="close-modal" class="absolute top-3 right-3 text-gray-400 hover:text-white transition-colors duration-200 z-20" aria-label="Close project details">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>

    {/* Header with title and meta info */}
    <div class="modal-header p-6 border-b border-gray-700/50">
      {/* IMPORTANT: ID used for aria-labelledby */}
      <h2 id="modal-title" class="text-2xl md:text-3xl font-bold text-teal-400 pr-8">Project Title Placeholder</h2>
      <div class="flex flex-wrap items-center gap-x-3 gap-y-1 mt-2">
        <p id="modal-role" class="text-sm text-gray-300 font-medium"></p>
        <span id="modal-separator" class="text-gray-500 hidden md:inline">|</span> {/* Added ID */}
        <p id="modal-date" class="text-sm text-gray-400"></p>
      </div>
    </div>

    {/* Scrollable Content area */}
    <div class="modal-body p-6 overflow-y-auto flex-1"> {/* Make body scrollable */}
      {/* Image carousel (if images are available) */}
      <div id="modal-carousel" class="mb-6 hidden">
        <div class="carousel-container relative h-64 md:h-80 bg-gray-900/50 rounded-lg overflow-hidden shadow-inner">
          <div id="carousel-slides" class="flex transition-transform duration-300 ease-in-out h-full">
            {/* Slides injected here */}
          </div>

          {/* Navigation arrows - Only show if multiple slides */}
          <button id="prev-slide" class="absolute top-1/2 left-2 transform -translate-y-1/2 bg-black/50 rounded-full p-2 text-white hover:bg-black/70 transition-colors duration-200 opacity-0 pointer-events-none carousel-nav" aria-label="Previous slide">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
          </button>
          <button id="next-slide" class="absolute top-1/2 right-2 transform -translate-y-1/2 bg-black/50 rounded-full p-2 text-white hover:bg-black/70 transition-colors duration-200 opacity-0 pointer-events-none carousel-nav" aria-label="Next slide">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </button>

          {/* Dots indicator - Only show if multiple slides */}
          <div id="carousel-dots" class="absolute bottom-3 left-0 right-0 flex justify-center gap-2 opacity-0 pointer-events-none carousel-nav">
             {/* Dots injected here */}
          </div>
        </div>
      </div>

      {/* Project description */}
      <div>
        <h3 class="text-xl font-semibold mb-3 text-white">Project Details</h3>
        {/* Use Tailwind prose for better typography if plugin installed */}
        <div id="modal-description" class="text-gray-300 space-y-4 prose prose-invert max-w-none prose-p:text-gray-300 prose-ul:text-gray-300 prose-li:text-gray-300">
          {/* Description injected here */}
        </div>
      </div>
    </div>

    {/* Footer with tags and links */}
    <div class="modal-footer p-6 border-t border-gray-700/50 bg-gray-800"> {/* Ensure footer isn't transparent */}
      <h4 class="text-sm font-semibold text-gray-400 mb-3">Technologies & Skills</h4>
      <div id="modal-tags" class="flex flex-wrap gap-2 mb-4">
         {/* Tags injected here */}
      </div>

      <div id="modal-links" class="flex flex-wrap gap-x-4 gap-y-2 mt-4 pt-4 border-t border-gray-700/30">
        {/* Links will be populated dynamically */}
        {/* Add download button for OEDASock project report */}
        {/* Links will be populated dynamically */}
      </div>
    </div>
  </div>
</div>

<script>
  // Store references to modal elements globally within the script's scope
  let modalElement: HTMLElement | null = null;
  let modalContentElement: HTMLElement | null = null;
  let modalTitleElement: HTMLElement | null = null;
  let modalRoleElement: HTMLElement | null = null;
  let modalDateElement: HTMLElement | null = null;
  let modalSeparatorElement: HTMLElement | null = null;
  let modalDescriptionElement: HTMLElement | null = null;
  let modalTagsElement: HTMLElement | null = null;
  let modalLinksElement: HTMLElement | null = null;
  let modalCarouselElement: HTMLElement | null = null;
  let carouselSlidesElement: HTMLElement | null = null;
  let carouselDotsElement: HTMLElement | null = null;
  let prevSlideButton: HTMLElement | null = null;
  let nextSlideButton: HTMLElement | null = null;
  let closeButton: HTMLElement | null = null;
  let modalBackdrop: HTMLElement | null = null;

  // Function to initialize element references
  function initializeModalElements() {
    modalElement = document.getElementById('project-modal');
    modalContentElement = modalElement?.querySelector('.modal-content') as HTMLElement | null;
    modalTitleElement = document.getElementById('modal-title');
    modalRoleElement = document.getElementById('modal-role');
    modalDateElement = document.getElementById('modal-date');
    modalSeparatorElement = document.getElementById('modal-separator');
    modalDescriptionElement = document.getElementById('modal-description');
    modalTagsElement = document.getElementById('modal-tags');
    modalLinksElement = document.getElementById('modal-links');
    modalCarouselElement = document.getElementById('modal-carousel');
    carouselSlidesElement = document.getElementById('carousel-slides');
    carouselDotsElement = document.getElementById('carousel-dots');
    prevSlideButton = document.getElementById('prev-slide');
    nextSlideButton = document.getElementById('next-slide');
    closeButton = document.getElementById('close-modal');
    modalBackdrop = document.getElementById('modal-backdrop');

    // Check if essential elements are found
    if (!modalElement || !modalContentElement || !closeButton || !modalBackdrop || !modalTitleElement) {
      console.error("Essential modal elements could not be found! Check IDs and structure.");
      return false;
    }
    return true;
  }

  interface Project {
    title: string;
    role?: string;
    date?: string;
    description: string;
    fullDescription?: string[];
    tags: string[];
    githubLink?: string;
    demoLink?: string;
    images?: Array<{ src: string; alt: string; type?: string }>;
  }

  let currentProject: Project | null = null;
  let currentSlide = 0;

  document.addEventListener('DOMContentLoaded', () => {
    // Try to initialize elements
    if (!initializeModalElements()) {
        return; // Stop if essential elements are missing
    }

    // Add event listeners only if elements exist
    if (closeButton) {
        closeButton.addEventListener('click', closeModal);
    }
    if (modalBackdrop) {
        modalBackdrop.addEventListener('click', closeModal);
    }
    if (prevSlideButton) {
        prevSlideButton.addEventListener('click', (e) => { e.stopPropagation(); navigateCarousel(-1); });
    }
    if (nextSlideButton) {
        nextSlideButton.addEventListener('click', (e) => { e.stopPropagation(); navigateCarousel(1); });
    }

    // Global Escape key listener
    document.addEventListener('keydown', (e) => {
      // Check if modal is visible before closing
      if (e.key === 'Escape' && modalElement && modalElement.classList.contains('active')) {
        closeModal();
      }
    });
  });

  // Open modal function
  function openProjectModal(project: Project) {
    if (!project) {
      console.error("openProjectModal called with null or undefined project data.");
      return;
    }
    if (!initializeModalElements()) return;

    currentProject = project;

    if (modalTitleElement) modalTitleElement.textContent = project.title;
    if (modalRoleElement) modalRoleElement.textContent = project.role ?? '';
    if (modalDateElement) modalDateElement.textContent = project.date ?? '';
    if (modalSeparatorElement) modalSeparatorElement.classList.toggle('hidden', !(project.role && project.date));

    if (modalDescriptionElement) {
      modalDescriptionElement.innerHTML = '';
      const descriptionContent = project.fullDescription ?? project.description;
      if (Array.isArray(descriptionContent)) {
        descriptionContent.forEach(para => {
          const p = document.createElement('p');
          p.innerHTML = para;
          modalDescriptionElement?.appendChild(p);
        });
      } else if (typeof descriptionContent === 'string') {
        modalDescriptionElement.innerHTML = descriptionContent;
      }

      // Add additional description for Mobile Game Development
      if (project.title === "Mobile + Desktop Game Development ('Squashed Orange')") {
        const additionalP = document.createElement('p');
        additionalP.className = 'text-gray-300 mt-4';
        additionalP.textContent = 'Development stopped sadly cos I got older and hit puberty but made a bit of money.';
        modalDescriptionElement.appendChild(additionalP);
      }

      // Add additional description for PPE Redistribution App
      if (project.title === "PPE Redistribution App") {
        const additionalP = document.createElement('p');
        additionalP.className = 'text-gray-300 mt-4';
        additionalP.textContent = 'Attempted to try partner with the NHS to help them distribute supplies, but sadly NHSX said they were not accepting any new contracts. Kinda annoying and was a bit disappointing when you realise they were giving out contracts to their sisters inlaws aunties uncles and their mates, but anyway we move.';
        modalDescriptionElement.appendChild(additionalP);
      }
    }

    if (modalTagsElement) {
      modalTagsElement.innerHTML = '';
      project.tags.forEach((tag: string) => {
        const span = document.createElement('span');
        span.className = 'bg-gray-700 text-gray-300 text-xs font-semibold px-2.5 py-0.5 rounded';
        span.textContent = tag;
        modalTagsElement?.appendChild(span);
      });
    }

    setupCarousel(project);

    // Populate links
    if (modalLinksElement) {
        modalLinksElement.innerHTML = ''; // Clear previous
        if (project.githubLink) {
            modalLinksElement.appendChild(createLink(project.githubLink, 'GitHub', `... GitHub SVG ...`)); // Abbreviated SVG
        }
        if (project.demoLink) { // Use demoLink as expected by previous code
            modalLinksElement.appendChild(createLink(project.demoLink, 'Live Demo', `... Demo Link SVG ...`)); // Abbreviated SVG
        }
        // Add download button for OEDASock project report
        if (project.title === "OedaSock (Imperial HCARD Competition Winner)") {
            const downloadButton = document.createElement('a');
            downloadButton.href = '/files/OedaSock_Report.pdf'; // Updated path to match the actual file location
            downloadButton.download = 'OedaSock-Project-Report.pdf';
            downloadButton.className = 'inline-flex items-center gap-1.5 text-teal-400 hover:text-teal-300 transition-colors duration-200 text-sm font-medium cursor-pointer';
            downloadButton.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                Download Report
            `;
            modalLinksElement.appendChild(downloadButton);
        }
        // Add legacy website link for Squashed Orange
        if (project.title === "Mobile Game Development ('Squashed Orange')") {
            const legacyLink = document.createElement('a');
            legacyLink.href = 'https://squashedorangedeveloper.wordpress.com/';
            legacyLink.target = '_blank';
            legacyLink.rel = 'noopener noreferrer';
            legacyLink.className = 'inline-flex items-center gap-1.5 text-teal-400 hover:text-teal-300 transition-colors duration-200 text-sm font-medium cursor-pointer';
            legacyLink.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                </svg>
                Legacy Website (No Longer Active)
            `;
            modalLinksElement.appendChild(legacyLink);
        }
        // Add legacy link for PPE Redistribution App
        if (project.title === "PPE Redistribution App") {
            const legacyLink = document.createElement('a');
            legacyLink.href = 'https://squashedorangedeveloper.wordpress.com/coronavirus-resource-supplies-covid-19/';
            legacyLink.target = '_blank';
            legacyLink.rel = 'noopener noreferrer';
            legacyLink.className = 'inline-flex items-center gap-1.5 text-teal-400 hover:text-teal-300 transition-colors duration-200 text-sm font-medium cursor-pointer';
            legacyLink.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                </svg>
                Legacy Development Website (Download Available)
            `;
            modalLinksElement.appendChild(legacyLink);
        }
        // Add legacy link for Personal Website
        if (project.title === "Personal Website (Previous Version)") {
            const legacyLink = document.createElement('a');
            legacyLink.href = 'https://github.com/anishmariathasan/anishmariathasan.com';
            legacyLink.target = '_blank';
            legacyLink.rel = 'noopener noreferrer';
            legacyLink.className = 'inline-flex items-center gap-1.5 text-teal-400 hover:text-teal-300 transition-colors duration-200 text-sm font-medium cursor-pointer';
            legacyLink.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 .5C5.649.5.5 5.649.5 12c0 5.094 3.292 9.41 7.865 10.942.575.106.785-.25.785-.557 0-.274-.01-1.189-.015-2.156-3.2.696-3.875-1.542-3.875-1.542-.523-1.333-1.276-1.688-1.276-1.688-1.043-.713.08-.699.08-.699 1.152.082 1.758 1.184 1.758 1.184 1.026 1.757 2.693 1.25 3.348.957.104-.744.402-1.25.731-1.537-2.555-.29-5.242-1.277-5.242-5.687 0-1.257.45-2.284 1.184-3.089-.119-.29-.513-1.462.113-3.048 0 0 .967-.31 3.168 1.18.918-.255 1.902-.382 2.88-.387.979.005 1.962.132 2.882.387 2.2-1.49 3.166-1.18 3.166-1.18.628 1.586.233 2.758.115 3.048.737.805 1.184 1.832 1.184 3.089 0 4.42-2.692 5.392-5.254 5.678.413.356.782 1.062.782 2.14 0 1.545-.014 2.79-.014 3.168 0 .31.207.67.792.557C20.71 21.408 24 17.094 24 12c0-6.351-5.149-11.5-12-11.5z"/>
                </svg>
                Legacy GitHub Repository
            `;
            modalLinksElement.appendChild(legacyLink);
        }
        // Add legacy link for Therakey
        if (project.title === "Therakey") {
            const legacyLink = document.createElement('a');
            legacyLink.href = 'https://github.com/anishmariathasan/group6';
            legacyLink.target = '_blank';
            legacyLink.rel = 'noopener noreferrer';
            legacyLink.className = 'inline-flex items-center gap-1.5 text-teal-400 hover:text-teal-300 transition-colors duration-200 text-sm font-medium cursor-pointer';
            legacyLink.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 .5C5.649.5.5 5.649.5 12c0 5.094 3.292 9.41 7.865 10.942.575.106.785-.25.785-.557 0-.274-.01-1.189-.015-2.156-3.2.696-3.875-1.542-3.875-1.542-.523-1.333-1.276-1.688-1.276-1.688-1.043-.713.08-.699.08-.699 1.152.082 1.758 1.184 1.758 1.184 1.026 1.757 2.693 1.25 3.348.957.104-.744.402-1.25.731-1.537-2.555-.29-5.242-1.277-5.242-5.687 0-1.257.45-2.284 1.184-3.089-.119-.29-.513-1.462.113-3.048 0 0 .967-.31 3.168 1.18.918-.255 1.902-.382 2.88-.387.979.005 1.962.132 2.882.387 2.2-1.49 3.166-1.18 3.166-1.18.628 1.586.233 2.758.115 3.048.737.805 1.184 1.832 1.184 3.089 0 4.42-2.692 5.392-5.254 5.678.413.356.782 1.062.782 2.14 0 1.545-.014 2.79-.014 3.168 0 .31.207.67.792.557C20.71 21.408 24 17.094 24 12c0-6.351-5.149-11.5-12-11.5z"/>
                </svg>
                Development Repository (Incomplete)
            `;
            const disclaimer = document.createElement('p');
            disclaimer.className = 'text-xs text-gray-400 mt-1 ml-6';
            disclaimer.textContent = 'Note: This repository does not reflect the finished work';
            modalLinksElement.appendChild(legacyLink);
            modalLinksElement.appendChild(disclaimer);
        }
    } else {
         console.error("Modal links element not found.");
    }

    // --- Show Modal ---
    if (modalElement && modalContentElement) {
        modalElement.classList.add('active');
        modalElement.classList.remove('opacity-0', 'pointer-events-none', 'hidden'); // Ensure hidden is removed
        modalContentElement.classList.remove('scale-95');
        document.body.classList.add('overflow-hidden'); // Prevent background scroll
        // Scroll modal body (not content element) to top
        const modalBody = modalElement.querySelector('.modal-body');
        if(modalBody) modalBody.scrollTop = 0;

        // Focus the modal container or close button for accessibility
         closeButton?.focus();

    } else {
        console.error("Cannot show modal - modalElement or modalContentElement not found.");
    }
  }

  function setupCarousel(project: Project) {
    if (!carouselSlidesElement || !modalCarouselElement || !carouselDotsElement || !prevSlideButton || !nextSlideButton) {
      console.error("Carousel elements missing");
      return;
    }

    // Clear previous content
    carouselSlidesElement.innerHTML = '';
    carouselDotsElement.innerHTML = '';

    if (!project.images || project.images.length === 0) {
      modalCarouselElement.classList.add('hidden');
      return;
    }

    modalCarouselElement.classList.remove('hidden');

    // Create slides
    project.images.forEach((image, index) => {
      const slide = document.createElement('div');
      slide.className = 'carousel-slide flex-shrink-0 w-full h-full';
      
      if (image.type === 'video') {
        // Create video element
        const video = document.createElement('video');
        video.src = image.src;
        video.className = 'w-full h-full object-contain';
        video.controls = true;
        video.autoplay = false;
        video.loop = true;
        video.muted = true;
        video.playsInline = true;
        slide.appendChild(video);

        // Add caption
        const caption = document.createElement('p');
        caption.className = 'text-sm text-gray-400 mt-2 text-center';
        caption.textContent = 'This is a display of all the app\'s features for proof';
        slide.appendChild(caption);
      } else {
        // Create image element
        const img = document.createElement('img');
        img.src = image.src;
        img.alt = image.alt;
        img.className = 'w-full h-full object-contain';
        slide.appendChild(img);
      }
      
      if (carouselSlidesElement) {
        carouselSlidesElement.appendChild(slide);
      }

      // Create dot
      const dot = document.createElement('button');
      dot.className = 'w-2 h-2 rounded-full bg-gray-500 hover:bg-gray-400 transition-colors duration-200';
      dot.setAttribute('aria-label', `Go to slide ${index + 1}`);
      dot.addEventListener('click', () => goToSlide(index));
      if (carouselDotsElement) {
        carouselDotsElement.appendChild(dot);
      }
    });

    // Show navigation if multiple slides
    const showNav = project.images.length > 1;
    prevSlideButton.classList.toggle('opacity-0', !showNav);
    prevSlideButton.classList.toggle('pointer-events-none', !showNav);
    nextSlideButton.classList.toggle('opacity-0', !showNav);
    nextSlideButton.classList.toggle('pointer-events-none', !showNav);
    carouselDotsElement.classList.toggle('opacity-0', !showNav);
    carouselDotsElement.classList.toggle('pointer-events-none', !showNav);

    // Reset to first slide
    currentSlide = 0;
    updateCarousel();
  }

  function updateCarousel() {
    if (!carouselSlidesElement || !carouselDotsElement) return;

    // Update slide position
    carouselSlidesElement.style.transform = `translateX(-${currentSlide * 100}%)`;

    // Update dots
    const dots = carouselDotsElement.querySelectorAll('button');
    dots.forEach((dot, index) => {
      dot.classList.toggle('bg-gray-400', index === currentSlide);
      dot.classList.toggle('bg-gray-500', index !== currentSlide);
    });
  }

  function navigateCarousel(direction: number) {
    if (!currentProject?.images) return;
    currentSlide = (currentSlide + direction + currentProject.images.length) % currentProject.images.length;
    updateCarousel();
  }

  function goToSlide(index: number) {
    if (!currentProject?.images) return;
    currentSlide = index;
    updateCarousel();
  }

  function closeModal() {
    if (!modalElement || !modalContentElement) return; // Check if elements exist

    modalElement.classList.remove('active');
    modalElement.classList.add('opacity-0', 'pointer-events-none');
    modalElement.classList.add('hidden'); // Explicitly hide after transition
    modalContentElement.classList.add('scale-95');
    document.body.classList.remove('overflow-hidden');
    currentProject = null; // Clear current project
  }

  // Helper to create links (SVG content abbreviated for clarity)
  function createLink(href: string, text: string, svgIcon: string) {
      const link = document.createElement('a');
      link.href = href;
      link.target = '_blank';
      link.rel = 'noopener noreferrer';
      link.className = 'inline-flex items-center gap-1.5 text-teal-400 hover:text-teal-300 transition-colors duration-200 text-sm font-medium cursor-pointer';
      // IMPORTANT: Replace placeholder SVGs with your actual SVG code
      if (text === 'GitHub') {
           link.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor"><path d="M12 .5C5.649.5.5 5.649.5 12c0 5.094 3.292 9.41 7.865 10.942.575.106.785-.25.785-.557 0-.274-.01-1.189-.015-2.156-3.2.696-3.875-1.542-3.875-1.542-.523-1.333-1.276-1.688-1.276-1.688-1.043-.713.08-.699.08-.699 1.152.082 1.758 1.184 1.758 1.184 1.026 1.757 2.693 1.25 3.348.957.104-.744.402-1.25.731-1.537-2.555-.29-5.242-1.277-5.242-5.687 0-1.257.45-2.284 1.184-3.089-.119-.29-.513-1.462.113-3.048 0 0 .967-.31 3.168 1.18.918-.255 1.902-.382 2.88-.387.979.005 1.962.132 2.882.387 2.2-1.49 3.166-1.18 3.166-1.18.628 1.586.233 2.758.115 3.048.737.805 1.184 1.832 1.184 3.089 0 4.42-2.692 5.392-5.254 5.678.413.356.782 1.062.782 2.14 0 1.545-.014 2.79-.014 3.168 0 .31.207.67.792.557C20.71 21.408 24 17.094 24 12c0-6.351-5.149-11.5-12-11.5z"/></svg> ${text}`;
      } else if (text === 'Live Demo') {
           link.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg> ${text}`;
      } else {
          link.textContent = text; // Fallback if no icon
      }
      return link;
  }

  // Expose open function to global scope

  declare global {
    interface Window {
      openProjectModal: (project: Project) => void;
    }
  }
  window.openProjectModal = openProjectModal;

</script>

<style>
  .modal-content {
    max-height: 90vh; /* Limit modal height */
  }
  .modal-body {
     /* Enable scrolling only for the body */
    -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
  }
  /* Add active class for visibility */
  #project-modal.active {
    opacity: 1;
    pointer-events: auto;
  }
   #project-modal.active .modal-content {
      transform: scale(1);
   }

  /* Ensure hidden class works */
  #project-modal.hidden {
      display: none;
  }

  /* Carousel nav fade-in (if desired) */
   .carousel-nav {
       transition: opacity 0.3s ease-in-out;
   }

  /* Custom scrollbar for modal body */
   .modal-body::-webkit-scrollbar {
      width: 8px;
    }
    .modal-body::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
    }
    .modal-body::-webkit-scrollbar-thumb {
      background: #4A5568; /* gray-600 */
      border-radius: 4px;
      border: 2px solid transparent;
      background-clip: content-box;
    }
    .modal-body::-webkit-scrollbar-thumb:hover {
      background: #2D3748; /* gray-700 */
    }

  /* Ensure all interactive elements have pointer cursor */
  #project-modal a,
  #project-modal button,
  #project-modal [role="button"] {
    cursor: pointer;
  }
</style>